<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ROBOSTREAKS CLUB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              slate: { 850: '#1e293b', 900: '#0f172a', 950: '#020617' },
              cyan: { 400: '#22d3ee', 500: '#06b6d4', 900: '#164e63' },
              emerald: { 400: '#34d399', 500: '#10b981' },
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['Fira Code', 'Courier New', 'monospace'],
            },
            animation: {
              'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'scan': 'scan 3s linear infinite',
              'fade-in': 'fadeIn 0.3s ease-out',
              'glitch': 'glitch 1s linear infinite',
              'typing': 'typing 3.5s steps(40, end)',
            },
            keyframes: {
              scan: {
                '0%': { transform: 'translateY(-100%)' },
                '100%': { transform: 'translateY(100%)' },
              },
              fadeIn: {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              },
              glitch: {
                '2%, 64%': { transform: 'translate(2px,0) skew(0deg)' },
                '4%, 60%': { transform: 'translate(-2px,0) skew(0deg)' },
                '62%': { transform: 'translate(0,0) skew(5deg)' },
              }
            }
          }
        }
      }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
    <style>
      :root {
        --color-bg: #050505;
        --color-term: #0f172a;
        --color-cyan: #06b6d4;
        --scanline-color: rgba(0, 0, 0, 0.5);
      }
      
      body { 
        background-color: var(--color-bg);
        color: #e2e8f0;
        font-family: 'Fira Code', monospace;
        overflow-x: hidden;
      }

      /* CRT Effect */
      .crt::before {
        content: " ";
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: linear-gradient(
          to bottom,
          rgba(18, 16, 16, 0) 50%,
          rgba(0, 0, 0, 0.25) 50%
        );
        background-size: 100% 4px;
        z-index: 999;
        pointer-events: none;
      }
      
      .bg-grid {
        background-image: 
          linear-gradient(rgba(6, 182, 212, 0.05) 1px, transparent 1px),
          linear-gradient(90deg, rgba(6, 182, 212, 0.05) 1px, transparent 1px);
        background-size: 30px 30px;
      }

      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: #020617; }
      ::-webkit-scrollbar-thumb { background: #1e293b; border: 1px solid #0f172a; }
      ::-webkit-scrollbar-thumb:hover { background: #06b6d4; }

      .glass-panel {
        background: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(6, 182, 212, 0.2);
        box-shadow: 0 0 20px rgba(6, 182, 212, 0.1);
      }

      .btn-cyber {
        position: relative;
        overflow: hidden;
        transition: all 0.3s;
        clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
      }
      .btn-cyber:hover {
        background-color: rgba(6, 182, 212, 0.2);
        text-shadow: 0 0 8px rgba(6, 182, 212, 0.8);
      }
      
      .text-glow {
        text-shadow: 0 0 10px rgba(34, 211, 238, 0.6);
      }
      
      .typing-effect {
        overflow: hidden;
        white-space: nowrap;
        border-right: 2px solid #06b6d4;
        animation: typing 3.5s steps(40, end), blink-caret .75s step-end infinite;
      }
      @keyframes blink-caret {
        from, to { border-color: transparent }
        50% { border-color: #06b6d4; }
      }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="crt min-h-screen bg-grid selection:bg-cyan-500/30 selection:text-cyan-200">

    <div id="app" class="relative min-h-screen flex flex-col z-10">
        <!-- JS Injects Content Here -->
    </div>

    <!-- Initialization Overlay -->
    <div id="boot-sequence" class="fixed inset-0 bg-black z-50 flex items-center justify-center font-mono text-cyan-500 text-xs">
        <div class="w-80">
            <div id="boot-text" class="mb-2 h-32 overflow-hidden whitespace-pre-wrap flex flex-col justify-end"></div>
            <div class="w-full h-1 bg-slate-800 rounded-full overflow-hidden">
                <div id="boot-progress" class="h-full bg-cyan-500 w-0 transition-all duration-[2000ms] ease-out"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI, Type } from "@google/genai";

        // --- DATA ---
        
        const MEMBERS = [
            { id: '1', name: 'Alice Johnson', email: 'alice@university.edu', password: 'password123', mobile: '+1 (555) 123-4567', branch: 'Computer Science', registrationNo: 'CS2024001', joinDate: '2023-09-01', status: 'ACTIVE', avatarUrl: 'https://picsum.photos/200/200?random=1' },
            { id: '2', name: 'Bob Smith', email: 'bob@university.edu', password: 'password123', mobile: '+1 (555) 987-6543', branch: 'Mech. Eng.', registrationNo: 'ME2024045', joinDate: '2023-09-15', status: 'ACTIVE', avatarUrl: 'https://picsum.photos/200/200?random=2' },
            { id: '3', name: 'Charlie Davis', email: 'charlie@university.edu', password: 'password123', mobile: '+1 (555) 456-7890', branch: 'Electronics', registrationNo: 'EC2024102', joinDate: '2024-01-10', status: 'INACTIVE', avatarUrl: 'https://picsum.photos/200/200?random=3' },
            { id: '4', name: 'Dana Lee', email: 'dana@university.edu', password: 'password123', mobile: '+1 (555) 222-3333', branch: 'Data Science', registrationNo: 'DS2024088', joinDate: '2023-11-20', status: 'ACTIVE', avatarUrl: 'https://picsum.photos/200/200?random=4' }
        ];

        const ANNOUNCEMENTS = [
            { id: '101', title: 'HACKATHON_2024', content: 'Protocol initiated for Annual Hackathon. Teams of 4 required. Execute registration.', date: '2024-05-20', type: 'EVENT' },
            { id: '102', title: 'SYS_MAINTENANCE', content: 'Server downtime scheduled [0200-0400]. Backup local data immediately.', date: '2024-05-18', type: 'URGENT' },
            { id: '103', title: 'AI_ETHICS_WORKSHOP', content: 'Guest lecture: "The Ghost in the Machine". Attendance optional but recommended.', date: '2024-05-15', type: 'GENERAL' }
        ];

        const ADMIN = { email: 'admin@nexus.com', password: 'admin' };

        // --- STATE ---

        const state = {
            view: 'BOOT', // BOOT, LOGIN, DASHBOARD
            user: null,    // { role: 'ADMIN' | 'MEMBER', details: ... }
            login: {
                tab: 'MEMBER',
                error: '',
                loading: false
            },
            admin: {
                selectedIds: new Set(),
                searchQuery: '',
                modalOpen: false,
                emailDraft: { topic: '', subject: '', body: '', recipients: [] },
                generating: false,
                sendStatus: 'IDLE' // IDLE, SENDING, SENT
            }
        };

        // --- SERVICES ---

        // Robust API Key handling
        const API_KEY = typeof process !== 'undefined' && process.env ? process.env.API_KEY : '';
        const ai = new GoogleGenAI({ apiKey: API_KEY });

        async function generateDraft(topic, recipientName) {
            if (!API_KEY) {
                console.warn("NEXUS_SYS: No API Key detected. Using simulation protocol.");
                await new Promise(r => setTimeout(r, 1500));
                return {
                    subject: `[SECURE]: Update regarding ${topic}`,
                    body: `Attention ${recipientName},\n\nWe are transmitting details regarding: ${topic}.\n\nPlease acknowledge receipt.\n\n// NEXUS ADMIN`
                };
            }

            try {
                const response = await ai.models.generateContent({
                    model: "gemini-2.5-flash",
                    contents: `Act as a Cyberpunk System Administrator. Write a short, technical, and professional email.
                    Recipient: ${recipientName}. Topic: ${topic}.
                    Output JSON only.`,
                    config: { 
                        responseMimeType: "application/json",
                        responseSchema: {
                          type: Type.OBJECT,
                          properties: {
                            subject: { type: Type.STRING },
                            body: { type: Type.STRING }
                          },
                          required: ["subject", "body"]
                        }
                    }
                });
                
                // Safe parsing of Gemini response
                const text = response.text;
                if (!text) throw new Error("Empty AI response");
                return JSON.parse(text);
            } catch (e) {
                console.error("AI_ERR:", e);
                return { subject: "SYS_ERR", body: "Could not generate content. Connection terminated." };
            }
        }

        // --- ICONS (SVG Strings) ---
        const Icons = {
            Shield: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>`,
            Mail: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>`,
            Terminal: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>`,
            User: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>`,
            Key: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg>`,
            Check: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`,
            Search: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>`,
            Users: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>`,
            Activity: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>`,
            AlertTriangle: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>`,
            CheckCircle: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
            XCircle: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
            Calendar: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>`,
            Info: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
            Smartphone: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>`,
            Hash: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" /></svg>`,
            QrCode: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4h-4v-2h2v-2h3v2h2v-2h2v2h2v-2h2v2h2v-2h2v2h-2v-2h-2v2h-2v-2h-2v2h-2v-2h-2v2h-2v-2h-2v2h-2v-2h-2v2H6v-4H4v-2h2v-2h2v2h2v-2h2v2h2v-2h2v2h2v-2h2v2h2v-2h2v2h2v-2h2v2z" /><rect x="2" y="2" width="7" height="7" /><rect x="14" y="2" width="7" height="7" /><rect x="2" y="14" width="7" height="7" /></svg>`,
            Sparkles: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>`,
            Send: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>`,
            X: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>`,
            Power: `<svg class="w-full h-full" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>`, // Placeholder for power
            Loader2: `<svg class="w-full h-full animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4h-4v-2h2v-2h3v2h2v-2h2v2h2v-2h2v2h2v-2h2v2h-2v-2h-2v2h-2v-2h-2v2h-2v-2h-2v2h-2v-2h-2v2h-2v-2h-2v2H6v-4H4v-2h2v-2h2v2h2v-2h2v2h2v-2h2v2h2v-2h2v2h2v-2h2v2z" /></svg>`
        };

        // --- RENDERERS ---

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = ''; // Clear DOM

            if (state.view === 'LOGIN') {
                app.innerHTML = renderLogin();
                bindLoginEvents();
            } else if (state.view === 'DASHBOARD') {
                app.innerHTML = renderLayout();
                bindLayoutEvents();
                
                const content = document.getElementById('main-content');
                if (state.user.role === 'ADMIN') {
                    content.innerHTML = renderAdmin();
                    bindAdminEvents();
                } else {
                    content.innerHTML = renderMember();
                }
            }
        }

        function renderLogin() {
            return `
            <div class="flex-grow flex items-center justify-center p-4 relative overflow-hidden">
                <div class="absolute inset-0 z-0 opacity-20 pointer-events-none">
                    <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-cyan-500 rounded-full blur-[128px]"></div>
                    <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-600 rounded-full blur-[128px]"></div>
                </div>

                <div class="w-full max-w-md relative z-10 animate-fade-in">
                    <div class="glass-panel p-1 rounded-sm">
                        <div class="bg-slate-950/80 p-8 border border-slate-800/50">
                            
                            <!-- Header -->
                            <div class="mb-8 text-center relative group cursor-default">
                                <h1 class="text-2xl font-bold text-white tracking-widest text-glow">ROBO<span class="text-cyan-500"> STREAKS</span></h1>
                                <p class="text-[10px] text-cyan-500/60 font-mono mt-2 tracking-[0.3em]">SECURE_ACCESS_TERMINAL_V2.0</p>
                                <div class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 w-16 h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent"></div>
                            </div>

                            <!-- Tabs -->
                            <div class="flex mb-8 border-b border-slate-800">
                                <button id="tab-member" class="flex-1 pb-3 text-xs font-bold uppercase tracking-widest transition-all ${state.login.tab === 'MEMBER' ? 'text-cyan-400 border-b-2 border-cyan-500 shadow-[0_10px_20px_-10px_rgba(6,182,212,0.5)]' : 'text-slate-600 hover:text-slate-400'}">
                                    Member
                                </button>
                                <button id="tab-admin" class="flex-1 pb-3 text-xs font-bold uppercase tracking-widest transition-all ${state.login.tab === 'ADMIN' ? 'text-red-400 border-b-2 border-red-500 shadow-[0_10px_20px_-10px_rgba(239,68,68,0.5)]' : 'text-slate-600 hover:text-slate-400'}">
                                    Admin
                                </button>
                            </div>

                            <!-- Form -->
                            <form id="login-form" class="space-y-6">
                                <div class="space-y-2">
                                    <label class="text-[10px] text-slate-500 uppercase tracking-widest font-bold flex items-center gap-2">
                                        <div class="w-3 h-3">${Icons.User}</div> Identity_Key
                                    </label>
                                    <input type="email" id="email" required 
                                        class="w-full bg-slate-900/50 border border-slate-700 text-cyan-100 px-4 py-3 text-sm focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500/50 outline-none transition-all placeholder-slate-700 font-mono"
                                        placeholder="${state.login.tab === 'MEMBER' ? 'usr@nexus.edu' : 'admin@nexus.sys'}"
                                    >
                                </div>
                                
                                <div class="space-y-2">
                                    <label class="text-[10px] text-slate-500 uppercase tracking-widest font-bold flex items-center gap-2">
                                        <div class="w-3 h-3">${Icons.Key}</div> Password
                                    </label>
                                    <input type="password" id="password" required 
                                        class="w-full bg-slate-900/50 border border-slate-700 text-cyan-100 px-4 py-3 text-sm focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500/50 outline-none transition-all placeholder-slate-700 font-mono"
                                        placeholder="••••••••"
                                    >
                                </div>

                                ${state.login.error ? `
                                    <div class="p-3 bg-red-900/20 border border-red-500/30 text-red-400 text-xs font-mono flex items-center gap-2 animate-pulse">
                                        <span class="text-lg font-bold">!</span> ${state.login.error}
                                    </div>
                                ` : ''}

                                <button type="submit" ${state.login.loading ? 'disabled' : ''} 
                                    class="w-full btn-cyber py-4 bg-cyan-600/10 border border-cyan-500/50 text-cyan-400 font-bold uppercase tracking-widest hover:bg-cyan-600/20 hover:text-cyan-300 disabled:opacity-50 disabled:cursor-not-allowed group">
                                    <span class="relative z-10 flex items-center justify-center gap-2">
                                        ${state.login.loading ? '<span class="animate-spin">/</span> AUTHENTICATING...' : `${state.login.tab} LOGIN >`}
                                    </span>
                                </button>
                            </form>

                            <div class="mt-8 pt-4 border-t border-slate-800/50 text-[10px] text-slate-600 font-mono text-center">
                                <span class="text-cyan-700">MEMBER:</span> alice@university.edu / password123 <br/>
                                <span class="text-red-900">ADMIN:</span> admin@nexus.com / admin
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
        }

        function renderLayout() {
            return `
            <div class="fixed top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-600 via-blue-600 to-purple-600 z-50 shadow-[0_0_15px_rgba(6,182,212,0.6)]"></div>
            
            <nav class="sticky top-0 z-40 bg-slate-950/90 backdrop-blur border-b border-slate-800">
                <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-cyan-500/10 border border-cyan-500/50 flex items-center justify-center text-cyan-400 font-bold">
                            <div class="w-4 h-4">${Icons.Terminal}</div>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-white font-bold tracking-wider">NEXUS<span class="text-cyan-500">_CORE</span></span>
                        </div>
                    </div>
                    
                    <div class="flex items-center gap-6">
                        <div class="hidden md:flex flex-col items-end text-[10px] font-mono">
                            <span class="text-cyan-100">${state.user.role === 'ADMIN' ? 'ROOT_ACCESS_GRANTED' : `ID: ${state.user.details.registrationNo}`}</span>
                            <span class="text-emerald-500 animate-pulse">● SECURE_LINK_ESTABLISHED</span>
                        </div>
                        <button id="logout-btn" class="px-4 py-1.5 border border-red-900/50 text-red-500/80 hover:text-red-400 hover:border-red-500 hover:bg-red-500/10 text-xs font-mono uppercase transition-all flex items-center gap-2">
                             Disconnect
                        </button>
                    </div>
                </div>
            </nav>

            <main id="main-content" class="flex-grow max-w-7xl w-full mx-auto p-6 relative z-10"></main>

            <footer class="border-t border-slate-800 bg-slate-950/50 mt-auto">
                <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between text-[10px] text-slate-500 font-mono uppercase">
                    <div>Sys_Time: <span id="clock" class="text-cyan-600">--:--:--</span></div>
                    <div>&copy 2025 Robostreaks Club, PMEC, BERHAMPUR</div>
                </div>
            </footer>`;
        }

        function renderMember() {
            const m = state.user.details;
            return `
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 animate-fade-in pb-8">
                <!-- Identity Module -->
                <div class="lg:col-span-4">
                    <div class="glass-panel sticky top-24 p-[1px] relative group overflow-hidden rounded-sm">
                         <!-- Decorative Scanline -->
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-cyan-500/10 to-transparent opacity-0 group-hover:opacity-100 animate-scan pointer-events-none z-10"></div>
                        
                        <div class="bg-slate-900/95 relative p-6 flex flex-col h-full">
                            <!-- Header -->
                            <div class="flex justify-between items-start mb-6 pb-4 border-b border-slate-800">
                                <div>
                                    <div class="text-[10px] text-cyan-500 font-mono tracking-widest uppercase">Identity_Matrix</div>
                                    <div class="text-white font-bold tracking-tight text-lg">MEMBER PASS</div>
                                </div>
                                <div class="w-6 h-6 text-cyan-500/50">${Icons.Shield}</div>
                            </div>
                            
                            <!-- Avatar -->
                            <div class="flex items-center gap-4 mb-8">
                                <div class="relative">
                                    <div class="w-20 h-20 rounded-sm overflow-hidden border border-slate-700 group-hover:border-cyan-500/50 transition-colors">
                                        <img src="${m.avatarUrl}" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all">
                                    </div>
                                    <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-slate-900 flex items-center justify-center rounded-sm border border-slate-800">
                                        <div class="w-2 h-2 rounded-full ${m.status === 'ACTIVE' ? 'bg-emerald-500 animate-pulse' : 'bg-red-500'}"></div>
                                    </div>
                                </div>
                                <div>
                                    <h2 class="text-xl font-bold text-white leading-tight">${m.name}</h2>
                                    <div class="text-xs text-slate-500 font-mono mt-1 flex items-center gap-1">
                                        <div class="w-3 h-3 inline-block">${Icons.User}</div> ${m.branch}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Data Grid -->
                            <div class="space-y-3 font-mono text-xs mb-8">
                                <div class="flex justify-between items-center group/item p-2 hover:bg-slate-800/50 rounded transition-colors">
                                    <span class="text-slate-500 flex items-center gap-2"><div class="w-3 h-3">${Icons.Hash}</div> REG_KEY</span>
                                    <span class="text-cyan-400 font-bold">${m.registrationNo}</span>
                                </div>
                                <div class="flex justify-between items-center group/item p-2 hover:bg-slate-800/50 rounded transition-colors">
                                    <span class="text-slate-500 flex items-center gap-2"><div class="w-3 h-3">${Icons.Mail}</div> EMAIL</span>
                                    <span class="text-slate-300 truncate max-w-[140px] text-right">${m.email}</span>
                                </div>
                                <div class="flex justify-between items-center group/item p-2 hover:bg-slate-800/50 rounded transition-colors">
                                    <span class="text-slate-500 flex items-center gap-2"><div class="w-3 h-3">${Icons.Smartphone}</div> COMMS</span>
                                    <span class="text-slate-300">${m.mobile}</span>
                                </div>
                                <div class="flex justify-between items-center group/item p-2 hover:bg-slate-800/50 rounded transition-colors">
                                    <span class="text-slate-500 flex items-center gap-2"><div class="w-3 h-3">${Icons.Activity}</div> STATUS</span>
                                    <span class="${m.status === 'ACTIVE' ? 'text-emerald-400' : 'text-red-400'}">[${m.status}]</span>
                                </div>
                            </div>
                            
                            <!-- Footer -->
                            <div class="mt-auto pt-6 border-t border-slate-800 flex justify-between items-end opacity-60">
                                <div class="flex flex-col gap-1">
                                    <span class="text-[8px] text-slate-600 uppercase">Authorized Signature</span>
                                    <div class="h-4 w-20 bg-slate-800/50"></div>
                                </div>
                                <div class="w-8 h-8 text-white">${Icons.QrCode}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feed -->
                <div class="lg:col-span-8">
                    <div class="mb-6 flex items-center gap-3">
                        <div class="w-5 h-5 text-cyan-500">${Icons.Activity}</div>
                        <h3 class="text-lg font-bold text-white tracking-wider">NETWORK_BROADCASTS</h3>
                        <div class="flex-grow h-[1px] bg-slate-800 ml-4"></div>
                    </div>

                    <div class="relative border-l border-slate-800 ml-3 space-y-8 pl-8 py-2">
                        ${ANNOUNCEMENTS.map(a => {
                            let iconSvg = Icons.Info;
                            let colorClass = "text-cyan-400 border-cyan-500/50 bg-cyan-500/10";
                            let iconBg = "bg-slate-900 border-cyan-500 text-cyan-500";
                            
                            if (a.type === 'URGENT') {
                                iconSvg = Icons.AlertTriangle;
                                colorClass = "text-red-400 border-red-500/50 bg-red-500/10";
                                iconBg = "bg-slate-900 border-red-500 text-red-500";
                            } else if (a.type === 'EVENT') {
                                iconSvg = Icons.Calendar;
                                colorClass = "text-purple-400 border-purple-500/50 bg-purple-500/10";
                                iconBg = "bg-slate-900 border-purple-500 text-purple-500";
                            }

                            return `
                                <div class="relative group">
                                    <div class="absolute -left-[41px] top-0 w-6 h-6 rounded-full border-2 ${iconBg} flex items-center justify-center z-10">
                                        <div class="w-3 h-3">${iconSvg}</div>
                                    </div>

                                    <div class="bg-slate-900/50 border border-slate-800 p-5 rounded-sm hover:border-slate-600 transition-all hover:translate-x-1 duration-300 relative overflow-hidden">
                                        <div class="absolute top-0 right-0 px-2 py-1 text-[10px] font-bold font-mono border-l border-b rounded-bl-sm ${colorClass}">
                                            ${a.type}
                                        </div>
                                        
                                        <div class="mb-2">
                                            <h4 class="font-bold text-slate-100 text-lg group-hover:text-cyan-400 transition-colors">${a.title}</h4>
                                            <span class="text-[10px] text-slate-500 font-mono flex items-center gap-1 mt-1">
                                                T-STAMP: ${a.date}
                                            </span>
                                        </div>
                                        
                                        <p class="text-sm text-slate-400 leading-relaxed border-t border-slate-800/50 pt-3 mt-3">
                                            ${a.content}
                                        </p>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            </div>`;
        }

        function renderAdmin() {
            // Logic for filtering
            const query = state.admin.searchQuery.toLowerCase();
            const filteredMembers = MEMBERS.filter(m => 
                m.name.toLowerCase().includes(query) || 
                m.email.toLowerCase().includes(query) ||
                m.registrationNo.toLowerCase().includes(query) ||
                m.branch.toLowerCase().includes(query)
            );

            // Logic for stats
            const stats = {
                total: MEMBERS.length,
                active: MEMBERS.filter(m => m.status === 'ACTIVE').length
            };

            const allSelected = filteredMembers.length > 0 && state.admin.selectedIds.size === filteredMembers.length;
            
            return `
            <div class="flex flex-col h-full animate-fade-in min-h-[600px] gap-6">
                <!-- Stats Row -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-slate-900/50 border border-slate-800 p-4 rounded-sm relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity w-12 h-12 text-cyan-500">${Icons.Users}</div>
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">Total Entities</p>
                        <div class="text-2xl font-bold text-white mt-1 font-mono">${stats.total.toString().padStart(3, '0')}</div>
                        <div class="h-1 w-full bg-slate-800 mt-3 rounded-full overflow-hidden"><div class="h-full bg-cyan-500 w-full"></div></div>
                    </div>
                    <div class="bg-slate-900/50 border border-slate-800 p-4 rounded-sm relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity w-12 h-12 text-emerald-500">${Icons.Activity}</div>
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">Active Nodes</p>
                        <div class="text-2xl font-bold text-emerald-400 mt-1 font-mono">${stats.active.toString().padStart(3, '0')}</div>
                        <div class="h-1 w-full bg-slate-800 mt-3 rounded-full overflow-hidden"><div class="h-full bg-emerald-500" style="width: ${(stats.active / stats.total) * 100}%"></div></div>
                    </div>
                    <div class="bg-slate-900/50 border border-slate-800 p-4 rounded-sm relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity w-12 h-12 text-amber-500">${Icons.AlertTriangle}</div>
                        <p class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">System Alerts</p>
                        <div class="text-2xl font-bold text-amber-400 mt-1 font-mono">002</div>
                        <div class="h-1 w-full bg-slate-800 mt-3 rounded-full overflow-hidden"><div class="h-full bg-amber-500 w-[10%] animate-pulse"></div></div>
                    </div>
                </div>

                <!-- Controls & Table -->
                <div class="flex flex-col flex-grow bg-slate-900/30 border border-slate-800 rounded-sm overflow-hidden">
                    <div class="p-4 border-b border-slate-800 bg-slate-950/50 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div class="relative w-full sm:w-64">
                            <div class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 w-4 h-4">${Icons.Search}</div>
                            <input type="text" id="search-input" placeholder="Search database..." value="${state.admin.searchQuery}"
                                class="w-full bg-slate-900 border border-slate-700 text-slate-200 pl-9 pr-4 py-2 text-xs font-mono rounded-sm focus:border-cyan-500 outline-none transition-colors placeholder:text-slate-600">
                        </div>
                        <div class="flex items-center gap-3 w-full sm:w-auto">
                            <div class="hidden sm:block text-[10px] text-slate-500 font-mono">SELECTED: <span class="text-cyan-400">${state.admin.selectedIds.size}</span></div>
                            <button id="broadcast-btn" class="flex-1 sm:flex-none relative overflow-hidden transition-all hover:bg-cyan-600/20 px-4 py-2 bg-cyan-600/10 border border-cyan-500/50 text-cyan-400 text-xs font-bold uppercase tracking-wider flex items-center justify-center gap-2 hover:text-white disabled:opacity-20 disabled:cursor-not-allowed disabled:bg-transparent" ${state.admin.selectedIds.size === 0 ? 'disabled' : ''}>
                                <div class="w-4 h-4">${Icons.Mail}</div>
                                <span class="hidden sm:inline">${state.admin.selectedIds.size === filteredMembers.length && filteredMembers.length > 0 ? 'Broadcast All' : 'Message Selected'}</span>
                                <span class="sm:hidden">Message (${state.admin.selectedIds.size})</span>
                            </button>
                        </div>
                    </div>

                    <div class="flex-grow overflow-auto">
                        <table class="w-full text-left text-sm text-slate-400 font-mono">
                            <thead class="bg-slate-950 border-b border-slate-800 text-[10px] uppercase text-slate-500 sticky top-0 z-10 font-bold tracking-wider">
                                <tr>
                                    <th class="px-6 py-3 w-12 text-center bg-slate-950">
                                        <input type="checkbox" id="select-all" class="accent-cyan-500 cursor-pointer" ${allSelected ? 'checked' : ''}>
                                    </th>
                                    <th class="px-6 py-3 bg-slate-950">Identity Profile</th>
                                    <th class="px-6 py-3 hidden md:table-cell bg-slate-950">Registration / Branch</th>
                                    <th class="px-6 py-3 text-center bg-slate-950">Status</th>
                                    <th class="px-6 py-3 text-center bg-slate-950">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-800/50">
                                ${filteredMembers.map(m => {
                                    const isSel = state.admin.selectedIds.has(m.id);
                                    const isActive = m.status === 'ACTIVE';
                                    return `
                                    <tr class="group hover:bg-slate-800/30 transition-colors ${isSel ? 'bg-cyan-900/5' : ''}">
                                        <td class="px-6 py-4 text-center">
                                            <input type="checkbox" class="member-cb accent-cyan-500 cursor-pointer" data-id="${m.id}" ${isSel ? 'checked' : ''}>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <div class="w-9 h-9 rounded-sm p-[1px] bg-gradient-to-br from-slate-700 to-transparent">
                                                    <img src="${m.avatarUrl}" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all">
                                                </div>
                                                <div class="flex flex-col">
                                                    <span class="text-slate-200 font-bold text-xs group-hover:text-cyan-300 transition-colors">${m.name}</span>
                                                    <span class="text-[10px] text-slate-600">${m.email}</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 hidden md:table-cell">
                                            <div class="flex flex-col">
                                                <span class="text-xs text-slate-300">${m.registrationNo}</span>
                                                <span class="text-[10px] text-cyan-600/80 uppercase">${m.branch}</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="inline-flex items-center gap-1.5 px-2 py-0.5 rounded text-[10px] font-bold border ${isActive ? 'bg-emerald-950/30 border-emerald-500/30 text-emerald-400' : 'bg-red-950/30 border-red-500/30 text-red-400'}">
                                                <div class="w-3 h-3">${isActive ? Icons.CheckCircle : Icons.XCircle}</div>
                                                ${m.status}
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center">
                                            <button class="single-msg-btn text-slate-500 hover:text-cyan-400 hover:bg-cyan-400/10 p-2 rounded transition-all" data-id="${m.id}" title="Direct Message">
                                                <div class="w-4 h-4">${Icons.Mail}</div>
                                            </button>
                                        </td>
                                    </tr>`;
                                }).join('')}
                                ${filteredMembers.length === 0 ? '<tr><td colSpan="5" class="py-12 text-center text-slate-600 text-xs italic">No entities found in database.</td></tr>' : ''}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            ${state.admin.modalOpen ? renderModal() : ''}`;
        }

        function renderModal() {
            const { emailDraft, sendStatus, generating } = state.admin;
            const sent = sendStatus === 'SENT';

            return `
            <div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
                <div class="w-full max-w-2xl bg-slate-900 border border-cyan-500/30 shadow-[0_0_50px_rgba(6,182,212,0.15)] flex flex-col max-h-[90vh] animate-fade-in relative overflow-hidden">
                    
                    <!-- Header -->
                    <div class="px-6 py-4 border-b border-slate-800 bg-slate-950 flex justify-between items-center">
                        <div class="flex items-center gap-2 text-cyan-500 font-mono">
                            <div class="w-4 h-4">${Icons.Terminal}</div> <span class="text-white font-bold tracking-wider">SECURE_TRANSMISSION</span>
                        </div>
                        <button id="close-modal" class="text-slate-500 hover:text-red-500"><div class="w-4 h-4">${Icons.X}</div></button>
                    </div>

                    <div class="p-6 overflow-y-auto bg-slate-900/50 relative">
                        ${sent ? `
                            <div class="py-12 flex flex-col items-center justify-center text-center animate-fade-in">
                                <div class="w-16 h-16 rounded-full border-2 border-emerald-500 text-emerald-500 flex items-center justify-center mb-4 shadow-[0_0_20px_rgba(16,185,129,0.3)]">
                                    <div class="w-8 h-8">${Icons.Check}</div>
                                </div>
                                <h3 class="text-xl font-bold text-white tracking-widest mb-2">PACKET_SENT</h3>
                                <p class="text-xs text-slate-500 font-mono">Encryption verified. Delivery confirmed.</p>
                            </div>
                        ` : `
                            <!-- AI Section -->
                            <div class="bg-cyan-900/10 border border-cyan-500/20 p-4 mb-6 relative">
                                <div class="absolute top-0 left-0 px-2 py-0.5 bg-cyan-500/20 text-[10px] text-cyan-400 font-mono">AI_GENERATOR</div>
                                <div class="mt-4 flex gap-2">
                                    <input type="text" id="draft-topic" class="flex-grow bg-slate-950 border border-slate-700 text-cyan-100 px-3 py-2 text-xs font-mono focus:border-cyan-500 outline-none" placeholder="Enter topic parameters (e.g. 'Meeting rescheduled')..." value="${emailDraft.topic}">
                                    <button id="generate-btn" class="bg-cyan-600/20 border border-cyan-500/50 text-cyan-400 px-4 text-xs font-bold hover:bg-cyan-600 hover:text-white transition-all disabled:opacity-50 flex items-center gap-2" ${generating || !emailDraft.topic ? 'disabled' : ''}>
                                        ${generating ? '<div class="animate-spin w-3 h-3 border-2 border-current border-t-transparent rounded-full"></div> PROCESSING...' : `<div class="w-3 h-3">${Icons.Sparkles}</div> EXECUTE`}
                                    </button>
                                </div>
                            </div>

                            <!-- Fields -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-[10px] text-slate-500 uppercase font-bold mb-1">To</label>
                                    <div class="w-full bg-slate-950/50 border border-slate-800 text-slate-400 px-3 py-2 text-xs font-mono truncate">
                                        ${emailDraft.recipients.length > 2 ? `${emailDraft.recipients.length} Recipients` : emailDraft.recipients.join(', ')}
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-[10px] text-slate-500 uppercase font-bold mb-1">Subject_Header</label>
                                    <input type="text" id="draft-subject" value="${emailDraft.subject}" class="w-full bg-slate-950 border border-slate-700 text-white px-3 py-2 text-sm font-mono focus:border-cyan-500 outline-none">
                                </div>
                                <div>
                                    <label class="block text-[10px] text-slate-500 uppercase font-bold mb-1">Payload_Body</label>
                                    <textarea id="draft-body" rows="8" class="w-full bg-slate-950 border border-slate-700 text-slate-300 p-3 text-sm font-mono focus:border-cyan-500 outline-none resize-none">${emailDraft.body}</textarea>
                                </div>
                            </div>
                        `}
                    </div>

                    ${!sent ? `
                        <div class="p-4 border-t border-slate-800 bg-slate-950 flex justify-end gap-3">
                            <button id="cancel-btn" class="px-4 py-2 text-xs text-slate-500 hover:text-white font-mono uppercase">Abort</button>
                            <button id="send-btn" class="px-6 py-2 bg-cyan-600 text-white text-xs font-bold font-mono uppercase tracking-wider hover:bg-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.3)] disabled:opacity-50 flex items-center gap-2" ${!emailDraft.subject ? 'disabled' : ''}>
                                ${sendStatus === 'SENDING' ? 'UPLOADING...' : `<div class="w-3 h-3">${Icons.Send}</div> TRANSMIT_DATA`}
                            </button>
                        </div>
                    ` : ''}
                </div>
            </div>`;
        }

        // --- BINDING ---

        function bindLoginEvents() {
            document.getElementById('tab-member')?.addEventListener('click', () => updateState({ login: { ...state.login, tab: 'MEMBER', error: '' } }));
            document.getElementById('tab-admin')?.addEventListener('click', () => updateState({ login: { ...state.login, tab: 'ADMIN', error: '' } }));
            
            document.getElementById('login-form')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                updateState({ login: { ...state.login, loading: true } });

                setTimeout(() => {
                    let success = false;
                    let user = null;

                    if (state.login.tab === 'ADMIN') {
                        if (email === ADMIN.email && password === ADMIN.password) {
                            success = true;
                            user = { role: 'ADMIN', details: ADMIN };
                        }
                    } else {
                        const m = MEMBERS.find(x => x.email === email && x.password === password);
                        if (m) {
                            success = true;
                            user = { role: 'MEMBER', details: m };
                        }
                    }

                    if (success) {
                        updateState({ view: 'DASHBOARD', user, login: { ...state.login, loading: false } });
                    } else {
                        updateState({ login: { ...state.login, error: 'ACCESS_DENIED: Invalid Credentials', loading: false } });
                    }
                }, 1000);
            });
        }

        function bindLayoutEvents() {
            document.getElementById('logout-btn')?.addEventListener('click', () => {
                updateState({ view: 'LOGIN', user: null, admin: { ...state.admin, selectedIds: new Set(), searchQuery: '' } });
            });
            
            // Clock
            const clock = document.getElementById('clock');
            if(clock) {
                const tick = () => { if(clock) clock.innerText = new Date().toLocaleTimeString(); };
                tick();
                setInterval(tick, 1000);
            }
        }

        function bindAdminEvents() {
            // Search
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    // Need to preserve focus, so we update state and re-render only if needed or rely on minimal dom updates?
                    // For simplicity in this single-file non-react implementation, full re-render on input.
                    // To keep focus, we'd need more complex logic. 
                    // Let's do a simple full re-render and restore focus.
                    state.admin.searchQuery = e.target.value;
                    render();
                    const newInput = document.getElementById('search-input');
                    newInput.focus();
                    newInput.setSelectionRange(newInput.value.length, newInput.value.length);
                });
            }

            // Select All
            document.getElementById('select-all')?.addEventListener('change', (e) => {
                const query = state.admin.searchQuery.toLowerCase();
                const filtered = MEMBERS.filter(m => 
                    m.name.toLowerCase().includes(query) || 
                    m.email.toLowerCase().includes(query) ||
                    m.registrationNo.toLowerCase().includes(query) ||
                    m.branch.toLowerCase().includes(query)
                );
                
                const newSet = new Set(e.target.checked ? filtered.map(m => m.id) : []);
                updateState({ admin: { ...state.admin, selectedIds: newSet } });
            });

            // Individual Checkbox
            document.querySelectorAll('.member-cb').forEach(cb => {
                cb.addEventListener('change', (e) => {
                    const id = e.target.dataset.id;
                    const newSet = new Set(state.admin.selectedIds);
                    if (e.target.checked) newSet.add(id); else newSet.delete(id);
                    updateState({ admin: { ...state.admin, selectedIds: newSet } });
                });
            });

            // Modal Openers
            document.getElementById('broadcast-btn')?.addEventListener('click', () => openModal());
            document.querySelectorAll('.single-msg-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    openModal([id]);
                });
            });

            if (state.admin.modalOpen) {
                document.getElementById('close-modal')?.addEventListener('click', closeModal);
                document.getElementById('cancel-btn')?.addEventListener('click', closeModal);
                
                // Live Input (Update state without re-render for text inputs to avoid focus loss, 
                // but since we are simple HTML, we attach listeners that update state object)
                const bindInput = (id, key) => {
                    const el = document.getElementById(id);
                    if(el) {
                        el.addEventListener('input', (e) => { state.admin.emailDraft[key] = e.target.value; });
                        // If we re-render, we lose focus. For this modal, we only re-render on big state changes (generating, sent).
                        // Inputs in modal don't trigger global render() in this simplified architecture unless we force it.
                        // We will allow manual input without triggering render().
                    }
                };
                bindInput('draft-topic', 'topic');
                bindInput('draft-subject', 'subject');
                bindInput('draft-body', 'body');

                // AI Generate (Re-renders to show loading/result)
                document.getElementById('generate-btn')?.addEventListener('click', async () => {
                    if (!state.admin.emailDraft.topic) return;
                    updateState({ admin: { ...state.admin, generating: true } });
                    
                    const recipients = state.admin.emailDraft.recipients;
                    let name = "All Members";
                    if (recipients.length === 1) {
                         const m = MEMBERS.find(mem => mem.email === recipients[0]);
                         if(m) name = m.name;
                    }
                    
                    const res = await generateDraft(state.admin.emailDraft.topic, name);
                    
                    state.admin.emailDraft.subject = res.subject;
                    state.admin.emailDraft.body = res.body;
                    state.admin.generating = false;
                    render(); // Re-render to show result
                });

                // Send
                document.getElementById('send-btn')?.addEventListener('click', () => {
                    updateState({ admin: { ...state.admin, sendStatus: 'SENDING' } });
                    setTimeout(() => {
                        updateState({ admin: { ...state.admin, sendStatus: 'SENT' } });
                        setTimeout(closeModal, 2000);
                    }, 1500);
                });
            }
        }

        function openModal(ids = null) {
            let emails = [];
            if (ids) {
                emails = MEMBERS.filter(m => ids.includes(m.id)).map(m => m.email);
            } else {
                emails = MEMBERS.filter(m => state.admin.selectedIds.has(m.id)).map(m => m.email);
            }
            if (emails.length === 0) return;

            updateState({ 
                admin: { 
                    ...state.admin, 
                    modalOpen: true, 
                    sendStatus: 'IDLE',
                    emailDraft: { topic: '', subject: '', body: '', recipients: emails }
                } 
            });
        }

        function closeModal() {
            updateState({ admin: { ...state.admin, modalOpen: false } });
        }

        function updateState(newState) {
            Object.assign(state, newState); 
            if(newState.login) state.login = newState.login;
            if(newState.admin) state.admin = newState.admin;
            render();
        }

        // --- INIT ---
        
        // Boot Sequence
        const bootText = [
            "Initializing ROBOSTREAKS...",
            "Loading Nexus Core Modules...",
            "Verifying Identity Protocols...",
            "Establishing Secure Link...",
            "Welcome, User."
        ];
        
        async function boot() {
            const bootEl = document.getElementById('boot-sequence');
            const textEl = document.getElementById('boot-text');
            const progEl = document.getElementById('boot-progress');
            
            setTimeout(() => { progEl.style.width = '100%'; }, 100);

            for (const line of bootText) {
                const lineDiv = document.createElement('div');
                lineDiv.className = "animate-typing overflow-hidden whitespace-nowrap";
                lineDiv.innerText = `> ${line}`;
                textEl.appendChild(lineDiv);
                await new Promise(r => setTimeout(r, 400));
            }
            
            await new Promise(r => setTimeout(r, 600));
            bootEl.style.opacity = '0';
            setTimeout(() => { 
                bootEl.remove(); 
                state.view = 'LOGIN';
                render(); 
            }, 500);
        }

        boot();

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>